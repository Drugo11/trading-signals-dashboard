<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Trading Signals Visualizer</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; margin: 20px; color: #333; }
      .tabs { display: flex; gap: 8px; margin-bottom: 12px; }
      .tabs button { padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
      .tabs button.active { background: #e0e0ff; border-color: #6a6aff; }
      table { border-collapse: collapse; width: 100%; margin-top: 10px; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background: #f0f0f0; }
      .pill { border-radius: 12px; padding: 3px 8px; font-weight: 600; display: inline-block; }
      .long { background: #e6ffe6; color: #135c13; border: 1px solid #8ad18a; }
      .short { background: #ffe6e6; color: #7c1212; border: 1px solid #d18a8a; }
      .flat { background: #f2f2f2; color: #333; border: 1px solid #ccc; }
    </style>
  </head>
  <body>
    <h1>Trading Signals Visualizer</h1>
    <div class="tabs">
      <button id="tab-ml" class="active">ML (beta)</button>
      <button id="tab-trend">Trend ETF</button>
      <button id="tab-xsmom">Momentum 12â€“1</button>
    </div>
    <label for="dateSelector">Data:</label>
    <select id="dateSelector"></select>
    <table id="signalsTable">
      <thead>
        <tr><th>Ticker</th><th>Prediction</th><th>Segnale</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <script src="signals.js"></script>
    <script src="signals_trend.js"></script>
    <script src="signals_xsmom.js"></script>
    <script>
      const dsML = (typeof signalsData !== 'undefined') ? signalsData : (typeof signals !== 'undefined' ? signals : []);
      const dsTrend = (typeof signals_trend !== 'undefined') ? signals_trend : [];
      const dsXSMOM = (typeof signals_xsmom !== 'undefined') ? signals_xsmom : [];
      let current = 'ml';
      let currentData = dsML;
      function setActive(tab) {
        document.getElementById('tab-ml').classList.toggle('active', tab === 'ml');
        document.getElementById('tab-trend').classList.toggle('active', tab === 'trend');
        document.getElementById('tab-xsmom').classList.toggle('active', tab === 'xsmom');
      }
      function numberFmt(x) {
        if (x === null || x === undefined) return '';
        return (x >= 0 ? '+' : '') + (100 * x).toFixed(2) + '%';
      }
      function pill(sig) {
        if (sig > 0) return '<span class="pill long">LONG</span>';
        if (sig < 0) return '<span class="pill short">SHORT</span>';
        return '<span class="pill flat">FLAT</span>';
      }
      function uniqueDates(data) {
        const s = new Set(data.map(d => d.date));
        return Array.from(s).sort();
      }
      function populateDates() {
        const sel = document.getElementById('dateSelector');
        sel.innerHTML = '';
        const dates = uniqueDates(currentData);
        dates.forEach(d => {
          const opt = document.createElement('option');
          opt.value = d;
          opt.textContent = d;
          sel.appendChild(opt);
        });
        if (dates.length) {
          sel.value = dates[dates.length - 1];
          renderTable();
        } else {
          document.querySelector('#signalsTable tbody').innerHTML = '<tr><td colspan="3">Nessun dato</td></tr>';
        }
      }
      function renderTable() {
        const selDate = document.getElementById('dateSelector').value;
        const rows = currentData.filter(r => r.date === selDate)
                                .sort((a, b) => (b.prediction || 0) - (a.prediction || 0));
        const tbody = document.querySelector('#signalsTable tbody');
        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.ticker}</td>
            <td>${(r.prediction != null) ? numberFmt(r.prediction) : ''}</td>
            <td>${pill(r.signal || 0)}</td>
          </tr>
        `).join('');
      }
      document.getElementById('dateSelector').addEventListener('change', renderTable);
      document.getElementById('tab-ml').addEventListener('click', () => {
        current = 'ml';
        currentData = dsML;
        setActive('ml');
        populateDates();
      });
      document.getElementById('tab-trend').addEventListener('click', () => {
        current = 'trend';
        currentData = dsTrend;
        setActive('trend');
        populateDates();
      });
      document.getElementById('tab-xsmom').addEventListener('click', () => {
        current = 'xsmom';
        currentData = dsXSMOM;
        setActive('xsmom');
        populateDates();
      });
      populateDates();
    </script>
  </body>
</html>
